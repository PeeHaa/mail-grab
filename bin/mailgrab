#!/usr/bin/env php
<?php

namespace PeeHaa\MailGrab\Bin;

use Amp\Loop;
use PeeHaa\MailGrab\Http\Server;

require_once __DIR__ . '/../vendor/autoload.php';

Loop::run(function () {
    $server = new Server(__DIR__ . '/../public', ['0.0.0.0', '[::]'], 1337);

    yield $server->start();

    if (strpos(PHP_OS, 'WIN') !== 0) {
        Loop::onSignal(SIGINT, function (string $watcherId) use ($server) {
            Loop::cancel($watcherId);

            yield $server->stop();
        });
    }
});
